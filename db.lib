# Функции для работы с базой данных для хранения списка сериалов
if [ ! "$L_DB_LIB" == "LOADED" ]; then
L_DB_LIB="LOADED"

. $BASEDIRECTORY/errors.lib

[ -f $DBFile ] || db_error "Файл базы данных не найден"

init_db(){
	log_it "Init DB $DBFile"
	if [ -e "$DBFile" ] && [ $FORCE -eq 1 ] || [ ! -e "$DBFile" ]; then
		[ -f "$DBFile" ] && rm -f $DBFile
		sqlite3 $DBFile "create table serials (codename TEXT, link TEXT);"
	else
		fatal_error "База данных уже существует! Используйте --force для обхода."
	fi
}

# Проверка на существование торрента в базе
# $1 - URL
torrent_exists(){
	if [ -z "`sqlite3 $DBFile "select link from serials where link='$1'"`" ]; then
		return 0
	else
		return 1
	fi
}

# Добавление адреса в базу
# $1 - кодовое имя
# $2 - URL
add_to_base(){
	torrent_exists $2
	[ $? -eq 0 ] && sqlite3 $DBFile "insert into serials values('$1','$2');"
}

purge_base(){
	[ "$1" == "YES, I KNOW WHAT IT IS" ] || return 1
	log_it "Purge DB $DBFile"
	sqlite3 $DBFile "drop table serials;"
	return 0
}


fi
